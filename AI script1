local loadstring = loadstring or load
local success, err = pcall(loadstring([[
-- 添加娱乐功能的完整脚本
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- 检测注入器名称
local injectorName = "未知注入器"
pcall(function()
    if syn then injectorName = "Synapse X" end
    if getexecutorname then injectorName = getexecutorname() or "KRNL" end
    if identifyexecutor then injectorName = identifyexecutor() or "ScriptWare" end
end)

-- 创建主UI - 放在CoreGui中防止死亡时被清除
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "EntertainmentGUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = CoreGui

-- 主容器
local MainContainer = Instance.new("Frame")
MainContainer.Name = "MainContainer"
MainContainer.Size = UDim2.new(0, 600, 0, 500) -- 增加高度以容纳娱乐功能
MainContainer.Position = UDim2.new(0.5, -300, 0.5, -250)
MainContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainContainer.BorderSizePixel = 0
MainContainer.Visible = true
MainContainer.Active = true
MainContainer.Draggable = true
MainContainer.Parent = ScreenGui

-- 圆角
local ContainerCorner = Instance.new("UICorner")
ContainerCorner.CornerRadius = UDim.new(0, 8)
ContainerCorner.Parent = MainContainer

-- 标题栏（用于拖动）
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainContainer

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

-- 标题文本
local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(1, -60, 1, 0)
TitleText.Position = UDim2.new(0, 10, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "控制面板"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.TextSize = 14
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Font = Enum.Font.GothamBold
TitleText.Parent = TitleBar

-- 侧边栏
local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 120, 1, -30)
Sidebar.Position = UDim2.new(0, 0, 0, 30)
Sidebar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
Sidebar.BorderSizePixel = 0
Sidebar.Parent = MainContainer

-- 导航按钮 - 添加娱乐功能
local NavButtons = {"主页", "功能", "传送", "娱乐", "设置"}

local NavContainer = Instance.new("Frame")
NavContainer.Name = "NavContainer"
NavContainer.Size = UDim2.new(1, 0, 1, 0)
NavContainer.Position = UDim2.new(0, 0, 0, 0)
NavContainer.BackgroundTransparency = 1
NavContainer.Parent = Sidebar

-- 创建导航按钮
for i, name in ipairs(NavButtons) do
    local button = Instance.new("TextButton")
    button.Name = name .. "Button"
    button.Size = UDim2.new(1, -10, 0, 32)
    button.Position = UDim2.new(0, 5, 0, 10 + (i-1) * 37)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    button.BorderSizePixel = 0
    button.Text = name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 12
    button.Font = Enum.Font.Gotham
    button.Parent = NavContainer
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button
end

-- 主内容区域
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -120, 1, -30)
ContentFrame.Position = UDim2.new(0, 120, 0, 30)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainContainer

-- 主页内容
local HomePage = Instance.new("Frame")
HomePage.Name = "HomePage"
HomePage.Size = UDim2.new(1, 0, 1, 0)
HomePage.BackgroundTransparency = 1
HomePage.Visible = true
HomePage.Parent = ContentFrame

-- 用户信息
local UserInfo = Instance.new("Frame")
UserInfo.Name = "UserInfo"
UserInfo.Size = UDim2.new(1, -20, 0, 80)
UserInfo.Position = UDim2.new(0, 10, 0, 10)
UserInfo.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
UserInfo.BorderSizePixel = 0
UserInfo.Parent = HomePage

local UserCorner = Instance.new("UICorner")
UserCorner.CornerRadius = UDim.new(0, 8)
UserCorner.Parent = UserInfo

-- 用户信息显示
local UserText = Instance.new("TextLabel")
UserText.Name = "UserText"
UserText.Size = UDim2.new(1, -10, 1, -10)
UserText.Position = UDim2.new(0, 5, 0, 5)
UserText.BackgroundTransparency = 1
UserText.Text = "用户: " .. player.Name .. "\n注入器: " .. injectorName
UserText.TextColor3 = Color3.fromRGB(255, 255, 255)
UserText.TextSize = 14
UserText.TextXAlignment = Enum.TextXAlignment.Left
UserText.TextYAlignment = Enum.TextYAlignment.Top
UserText.Font = Enum.Font.Gotham
UserText.Parent = UserInfo

-- 功能页面
local FunctionsPage = Instance.new("Frame")
FunctionsPage.Name = "FunctionsPage"
FunctionsPage.Size = UDim2.new(1, 0, 1, 0)
FunctionsPage.BackgroundTransparency = 1
FunctionsPage.Visible = false
FunctionsPage.Parent = ContentFrame

-- 透视功能
local ESPButton = Instance.new("TextButton")
ESPButton.Name = "ESPButton"
ESPButton.Size = UDim2.new(0.45, 0, 0, 35)
ESPButton.Position = UDim2.new(0.025, 0, 0, 10)
ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
ESPButton.BorderSizePixel = 0
ESPButton.Text = "透视: 关闭"
ESPButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPButton.TextSize = 14
ESPButton.Font = Enum.Font.Gotham
ESPButton.Parent = FunctionsPage

local ESPCorner = Instance.new("UICorner")
ESPCorner.CornerRadius = UDim.new(0, 6)
ESPCorner.Parent = ESPButton

-- 飞行功能
local FlyButton = Instance.new("TextButton")
FlyButton.Name = "FlyButton"
FlyButton.Size = UDim2.new(0.45, 0, 0, 35)
FlyButton.Position = UDim2.new(0.525, 0, 0, 10)
FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
FlyButton.BorderSizePixel = 0
FlyButton.Text = "飞行: 关闭"
FlyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyButton.TextSize = 14
FlyButton.Font = Enum.Font.Gotham
FlyButton.Parent = FunctionsPage

local FlyCorner = Instance.new("UICorner")
FlyCorner.CornerRadius = UDim.new(0, 6)
FlyCorner.Parent = FlyButton

-- 飞行速度滑块
local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Name = "SpeedLabel"
SpeedLabel.Size = UDim2.new(1, -20, 0, 20)
SpeedLabel.Position = UDim2.new(0, 10, 0, 60)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Text = "飞行速度: 50"
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedLabel.TextSize = 14
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.Parent = FunctionsPage

local SpeedSlider = Instance.new("Frame")
SpeedSlider.Name = "SpeedSlider"
SpeedSlider.Size = UDim2.new(1, -20, 0, 15)
SpeedSlider.Position = UDim2.new(0, 10, 0, 85)
SpeedSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
SpeedSlider.BorderSizePixel = 0
SpeedSlider.Parent = FunctionsPage

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(0, 7)
SliderCorner.Parent = SpeedSlider

local SliderFill = Instance.new("Frame")
SliderFill.Name = "SliderFill"
SliderFill.Size = UDim2.new(0.5, 0, 1, 0)
SliderFill.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
SliderFill.BorderSizePixel = 0
SliderFill.Parent = SpeedSlider

local FillCorner = Instance.new("UICorner")
FillCorner.CornerRadius = UDim.new(0, 7)
FillCorner.Parent = SliderFill

local SliderButton = Instance.new("TextButton")
SliderButton.Name = "SliderButton"
SliderButton.Size = UDim2.new(1, 0, 1, 0)
SliderButton.BackgroundTransparency = 1
SliderButton.Text = ""
SliderButton.Parent = SpeedSlider

-- 移动速度功能
local SpeedBoostButton = Instance.new("TextButton")
SpeedBoostButton.Name = "SpeedBoostButton"
SpeedBoostButton.Size = UDim2.new(0.45, 0, 0, 35)
SpeedBoostButton.Position = UDim2.new(0.025, 0, 0, 120)
SpeedBoostButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
SpeedBoostButton.BorderSizePixel = 0
SpeedBoostButton.Text = "移动加速: 关闭"
SpeedBoostButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedBoostButton.TextSize = 14
SpeedBoostButton.Font = Enum.Font.Gotham
SpeedBoostButton.Parent = FunctionsPage

local SpeedBoostCorner = Instance.new("UICorner")
SpeedBoostCorner.CornerRadius = UDim.new(0, 6)
SpeedBoostCorner.Parent = SpeedBoostButton

-- 移动速度滑块
local WalkSpeedLabel = Instance.new("TextLabel")
WalkSpeedLabel.Name = "WalkSpeedLabel"
WalkSpeedLabel.Size = UDim2.new(1, -20, 0, 20)
WalkSpeedLabel.Position = UDim2.new(0, 10, 0, 170)
WalkSpeedLabel.BackgroundTransparency = 1
WalkSpeedLabel.Text = "移动速度: 50"
WalkSpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
WalkSpeedLabel.TextSize = 14
WalkSpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
WalkSpeedLabel.Font = Enum.Font.Gotham
WalkSpeedLabel.Parent = FunctionsPage

local WalkSpeedSlider = Instance.new("Frame")
WalkSpeedSlider.Name = "WalkSpeedSlider"
WalkSpeedSlider.Size = UDim2.new(1, -20, 0, 15)
WalkSpeedSlider.Position = UDim2.new(0, 10, 0, 195)
WalkSpeedSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
WalkSpeedSlider.BorderSizePixel = 0
WalkSpeedSlider.Parent = FunctionsPage

local WalkSliderCorner = Instance.new("UICorner")
WalkSliderCorner.CornerRadius = UDim.new(0, 7)
WalkSliderCorner.Parent = WalkSpeedSlider

local WalkSliderFill = Instance.new("Frame")
WalkSliderFill.Name = "WalkSliderFill"
WalkSliderFill.Size = UDim2.new(0.1, 0, 1, 0)
WalkSliderFill.BackgroundColor3 = Color3.fromRGB(80, 255, 160)
WalkSliderFill.BorderSizePixel = 0
WalkSliderFill.Parent = WalkSpeedSlider

local WalkFillCorner = Instance.new("UICorner")
WalkFillCorner.CornerRadius = UDim.new(0, 7)
WalkFillCorner.Parent = WalkSliderFill

local WalkSliderButton = Instance.new("TextButton")
WalkSliderButton.Name = "WalkSliderButton"
WalkSliderButton.Size = UDim2.new(1, 0, 1, 0)
WalkSliderButton.BackgroundTransparency = 1
WalkSliderButton.Text = ""
WalkSliderButton.Parent = WalkSpeedSlider

-- 传送功能页面
local TeleportPage = Instance.new("Frame")
TeleportPage.Name = "TeleportPage"
TeleportPage.Size = UDim2.new(1, 0, 1, 0)
TeleportPage.BackgroundTransparency = 1
TeleportPage.Visible = false
TeleportPage.Parent = ContentFrame

-- 玩家列表容器
local PlayerListContainer = Instance.new("Frame")
PlayerListContainer.Name = "PlayerListContainer"
PlayerListContainer.Size = UDim2.new(0.6, 0, 1, -10)
PlayerListContainer.Position = UDim2.new(0, 0, 0, 5)
PlayerListContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
PlayerListContainer.BorderSizePixel = 0
PlayerListContainer.Parent = TeleportPage

local PlayerListCorner = Instance.new("UICorner")
PlayerListCorner.CornerRadius = UDim.new(0, 8)
PlayerListCorner.Parent = PlayerListContainer

-- 玩家列表标题
local PlayerListTitle = Instance.new("TextLabel")
PlayerListTitle.Name = "PlayerListTitle"
PlayerListTitle.Size = UDim2.new(1, 0, 0, 30)
PlayerListTitle.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
PlayerListTitle.BorderSizePixel = 0
PlayerListTitle.Text = "玩家列表"
PlayerListTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerListTitle.TextSize = 14
PlayerListTitle.Font = Enum.Font.GothamBold
PlayerListTitle.Parent = PlayerListContainer

local PlayerListTitleCorner = Instance.new("UICorner")
PlayerListTitleCorner.CornerRadius = UDim.new(0, 8)
PlayerListTitleCorner.Parent = PlayerListTitle

-- 折叠按钮
local ToggleListButton = Instance.new("TextButton")
ToggleListButton.Name = "ToggleListButton"
ToggleListButton.Size = UDim2.new(0, 30, 0, 30)
ToggleListButton.Position = UDim2.new(1, -35, 0, 0)
ToggleListButton.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
ToggleListButton.BorderSizePixel = 0
ToggleListButton.Text = "◀"
ToggleListButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleListButton.TextSize = 14
ToggleListButton.Parent = PlayerListTitle

local ToggleListCorner = Instance.new("UICorner")
ToggleListCorner.CornerRadius = UDim.new(0, 6)
ToggleListCorner.Parent = ToggleListButton

-- 玩家列表滚动框
local PlayerScrollFrame = Instance.new("ScrollingFrame")
PlayerScrollFrame.Name = "PlayerScrollFrame"
PlayerScrollFrame.Size = UDim2.new(1, -10, 1, -40)
PlayerScrollFrame.Position = UDim2.new(0, 5, 0, 35)
PlayerScrollFrame.BackgroundTransparency = 1
PlayerScrollFrame.BorderSizePixel = 0
PlayerScrollFrame.ScrollBarThickness = 5
PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayerScrollFrame.Parent = PlayerListContainer

-- 传送控制区域
local TeleportControlContainer = Instance.new("Frame")
TeleportControlContainer.Name = "TeleportControlContainer"
TeleportControlContainer.Size = UDim2.new(0.35, 0, 1, -10)
TeleportControlContainer.Position = UDim2.new(0.65, 0, 0, 5)
TeleportControlContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
TeleportControlContainer.BorderSizePixel = 0
TeleportControlContainer.Parent = TeleportPage

local TeleportControlCorner = Instance.new("UICorner")
TeleportControlCorner.CornerRadius = UDim.new(0, 8)
TeleportControlCorner.Parent = TeleportControlContainer

-- 传送按钮
local TeleportButton = Instance.new("TextButton")
TeleportButton.Name = "TeleportButton"
TeleportButton.Size = UDim2.new(1, -20, 0, 40)
TeleportButton.Position = UDim2.new(0, 10, 0, 20)
TeleportButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
TeleportButton.BorderSizePixel = 0
TeleportButton.Text = "传送到玩家"
TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportButton.TextSize = 14
TeleportButton.Font = Enum.Font.Gotham
TeleportButton.Parent = TeleportControlContainer

local TeleportCorner = Instance.new("UICorner")
TeleportCorner.CornerRadius = UDim.new(0, 6)
TeleportCorner.Parent = TeleportButton

-- 锁定传送按钮
local LockTeleportButton = Instance.new("TextButton")
LockTeleportButton.Name = "LockTeleportButton"
LockTeleportButton.Size = UDim2.new(1, -20, 0, 40)
LockTeleportButton.Position = UDim2.new(0, 10, 0, 70)
LockTeleportButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
LockTeleportButton.BorderSizePixel = 0
LockTeleportButton.Text = "锁定传送: 关闭"
LockTeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LockTeleportButton.TextSize = 14
LockTeleportButton.Font = Enum.Font.Gotham
LockTeleportButton.Parent = TeleportControlContainer

local LockTeleportCorner = Instance.new("UICorner")
LockTeleportCorner.CornerRadius = UDim.new(0, 6)
LockTeleportCorner.Parent = LockTeleportButton

-- 选中的玩家显示
local SelectedPlayerLabel = Instance.new("TextLabel")
SelectedPlayerLabel.Name = "SelectedPlayerLabel"
SelectedPlayerLabel.Size = UDim2.new(1, -20, 0, 40)
SelectedPlayerLabel.Position = UDim2.new(0, 10, 0, 130)
SelectedPlayerLabel.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
SelectedPlayerLabel.BorderSizePixel = 0
SelectedPlayerLabel.Text = "未选择玩家"
SelectedPlayerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SelectedPlayerLabel.TextSize = 14
SelectedPlayerLabel.Font = Enum.Font.Gotham
SelectedPlayerLabel.Parent = TeleportControlContainer

local SelectedPlayerCorner = Instance.new("UICorner")
SelectedPlayerCorner.CornerRadius = UDim.new(0, 6)
SelectedPlayerCorner.Parent = SelectedPlayerLabel

-- 娱乐功能页面
local EntertainmentPage = Instance.new("Frame")
EntertainmentPage.Name = "EntertainmentPage"
EntertainmentPage.Size = UDim2.new(1, 0, 1, 0)
EntertainmentPage.BackgroundTransparency = 1
EntertainmentPage.Visible = false
EntertainmentPage.Parent = ContentFrame

-- 娱乐功能标题
local EntertainmentTitle = Instance.new("TextLabel")
EntertainmentTitle.Name = "EntertainmentTitle"
EntertainmentTitle.Size = UDim2.new(1, -20, 0, 30)
EntertainmentTitle.Position = UDim2.new(0, 10, 0, 10)
EntertainmentTitle.BackgroundTransparency = 1
EntertainmentTitle.Text = "娱乐功能"
EntertainmentTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
EntertainmentTitle.TextSize = 18
EntertainmentTitle.TextXAlignment = Enum.TextXAlignment.Left
EntertainmentTitle.Font = Enum.Font.GothamBold
EntertainmentTitle.Parent = EntertainmentPage

-- 滑稽走路功能
local FunnyWalkButton = Instance.new("TextButton")
FunnyWalkButton.Name = "FunnyWalkButton"
FunnyWalkButton.Size = UDim2.new(0.45, 0, 0, 35)
FunnyWalkButton.Position = UDim2.new(0.025, 0, 0, 50)
FunnyWalkButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
FunnyWalkButton.BorderSizePixel = 0
FunnyWalkButton.Text = "滑稽走路: 关闭"
FunnyWalkButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FunnyWalkButton.TextSize = 14
FunnyWalkButton.Font = Enum.Font.Gotham
FunnyWalkButton.Parent = EntertainmentPage

local FunnyWalkCorner = Instance.new("UICorner")
FunnyWalkCorner.CornerRadius = UDim.new(0, 6)
FunnyWalkCorner.Parent = FunnyWalkButton

-- 跳舞功能
local DanceButton = Instance.new("TextButton")
DanceButton.Name = "DanceButton"
DanceButton.Size = UDim2.new(0.45, 0, 0, 35)
DanceButton.Position = UDim2.new(0.525, 0, 0, 50)
DanceButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
DanceButton.BorderSizePixel = 0
DanceButton.Text = "跳舞: 关闭"
DanceButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DanceButton.TextSize = 14
DanceButton.Font = Enum.Font.Gotham
DanceButton.Parent = EntertainmentPage

local DanceCorner = Instance.new("UICorner")
DanceCorner.CornerRadius = UDim.new(0, 6)
DanceCorner.Parent = DanceButton

-- 变大变小功能
local SizeToggleButton = Instance.new("TextButton")
SizeToggleButton.Name = "SizeToggleButton"
SizeToggleButton.Size = UDim2.new(0.45, 0, 0, 35)
SizeToggleButton.Position = UDim2.new(0.025, 0, 0, 95)
SizeToggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
SizeToggleButton.BorderSizePixel = 0
SizeToggleButton.Text = "变大变小: 关闭"
SizeToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SizeToggleButton.TextSize = 14
SizeToggleButton.Font = Enum.Font.Gotham
SizeToggleButton.Parent = EntertainmentPage

local SizeToggleCorner = Instance.new("UICorner")
SizeToggleCorner.CornerRadius = UDim.new(0, 6)
SizeToggleCorner.Parent = SizeToggleButton

-- 彩虹特效功能
local RainbowEffectButton = Instance.new("TextButton")
RainbowEffectButton.Name = "RainbowEffectButton"
RainbowEffectButton.Size = UDim2.new(0.45, 0, 0, 35)
RainbowEffectButton.Position = UDim2.new(0.525, 0, 0, 95)
RainbowEffectButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
RainbowEffectButton.BorderSizePixel = 0
RainbowEffectButton.Text = "彩虹特效: 关闭"
RainbowEffectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RainbowEffectButton.TextSize = 14
RainbowEffectButton.Font = Enum.Font.Gotham
RainbowEffectButton.Parent = EntertainmentPage

local RainbowEffectCorner = Instance.new("UICorner")
RainbowEffectCorner.CornerRadius = UDim.new(0, 6)
RainbowEffectCorner.Parent = RainbowEffectButton

-- 滑稽走路速度滑块
local FunnyWalkSpeedLabel = Instance.new("TextLabel")
FunnyWalkSpeedLabel.Name = "FunnyWalkSpeedLabel"
FunnyWalkSpeedLabel.Size = UDim2.new(1, -20, 0, 20)
FunnyWalkSpeedLabel.Position = UDim2.new(0, 10, 0, 150)
FunnyWalkSpeedLabel.BackgroundTransparency = 1
FunnyWalkSpeedLabel.Text = "走路动画速度: 10"
FunnyWalkSpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FunnyWalkSpeedLabel.TextSize = 14
FunnyWalkSpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
FunnyWalkSpeedLabel.Font = Enum.Font.Gotham
FunnyWalkSpeedLabel.Parent = EntertainmentPage

local FunnyWalkSpeedSlider = Instance.new("Frame")
FunnyWalkSpeedSlider.Name = "FunnyWalkSpeedSlider"
FunnyWalkSpeedSlider.Size = UDim2.new(1, -20, 0, 15)
FunnyWalkSpeedSlider.Position = UDim2.new(0, 10, 0, 175)
FunnyWalkSpeedSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
FunnyWalkSpeedSlider.BorderSizePixel = 0
FunnyWalkSpeedSlider.Parent = EntertainmentPage

local FunnyWalkSliderCorner = Instance.new("UICorner")
FunnyWalkSliderCorner.CornerRadius = UDim.new(0, 7)
FunnyWalkSliderCorner.Parent = FunnyWalkSpeedSlider

local FunnyWalkSliderFill = Instance.new("Frame")
FunnyWalkSliderFill.Name = "FunnyWalkSliderFill"
FunnyWalkSliderFill.Size = UDim2.new(0.2, 0, 1, 0) -- 默认10/50=0.2
FunnyWalkSliderFill.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
FunnyWalkSliderFill.BorderSizePixel = 0
FunnyWalkSliderFill.Parent = FunnyWalkSpeedSlider

local FunnyWalkFillCorner = Instance.new("UICorner")
FunnyWalkFillCorner.CornerRadius = UDim.new(0, 7)
FunnyWalkFillCorner.Parent = FunnyWalkSliderFill

local FunnyWalkSliderButton = Instance.new("TextButton")
FunnyWalkSliderButton.Name = "FunnyWalkSliderButton"
FunnyWalkSliderButton.Size = UDim2.new(1, 0, 1, 0)
FunnyWalkSliderButton.BackgroundTransparency = 1
FunnyWalkSliderButton.Text = ""
FunnyWalkSliderButton.Parent = FunnyWalkSpeedSlider

-- 设置页面
local SettingsPage = Instance.new("Frame")
SettingsPage.Name = "SettingsPage"
SettingsPage.Size = UDim2.new(1, 0, 1, 0)
SettingsPage.BackgroundTransparency = 1
SettingsPage.Visible = false
SettingsPage.Parent = ContentFrame

-- 设置标题
local SettingsTitle = Instance.new("TextLabel")
SettingsTitle.Name = "SettingsTitle"
SettingsTitle.Size = UDim2.new(1, -20, 0, 30)
SettingsTitle.Position = UDim2.new(0, 10, 0, 10)
SettingsTitle.BackgroundTransparency = 1
SettingsTitle.Text = "设置"
SettingsTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
SettingsTitle.TextSize = 18
SettingsTitle.TextXAlignment = Enum.TextXAlignment.Left
SettingsTitle.Font = Enum.Font.GothamBold
SettingsTitle.Parent = SettingsPage

-- 重置UI位置按钮
local ResetUIButton = Instance.new("TextButton")
ResetUIButton.Name = "ResetUIButton"
ResetUIButton.Size = UDim2.new(0.5, -15, 0, 35)
ResetUIButton.Position = UDim2.new(0, 10, 0, 50)
ResetUIButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
ResetUIButton.BorderSizePixel = 0
ResetUIButton.Text = "重置UI位置"
ResetUIButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResetUIButton.TextSize = 14
ResetUIButton.Font = Enum.Font.Gotham
ResetUIButton.Parent = SettingsPage

local ResetUICorner = Instance.new("UICorner")
ResetUICorner.CornerRadius = UDim.new(0, 6)
ResetUICorner.Parent = ResetUIButton

-- 隐藏UI按钮
local HideUIButton = Instance.new("TextButton")
HideUIButton.Name = "HideUIButton"
HideUIButton.Size = UDim2.new(0.5, -15, 0, 35)
HideUIButton.Position = UDim2.new(0.5, 5, 0, 50)
HideUIButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
HideUIButton.BorderSizePixel = 0
HideUIButton.Text = "隐藏UI"
HideUIButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HideUIButton.TextSize = 14
HideUIButton.Font = Enum.Font.Gotham
HideUIButton.Parent = SettingsPage

local HideUICorner = Instance.new("UICorner")
HideUICorner.CornerRadius = UDim.new(0, 6)
HideUICorner.Parent = HideUIButton

-- 最小化按钮
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -35, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "×"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 18
MinimizeButton.Visible = true
MinimizeButton.Parent = TitleBar

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

-- 最小化后的按钮（悬浮窗）
local MinimizedButton = Instance.new("TextButton")
MinimizedButton.Name = "MinimizedButton"
MinimizedButton.Size = UDim2.new(0, 50, 0, 50)
MinimizedButton.Position = UDim2.new(0, 10, 0, 10)
MinimizedButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
MinimizedButton.BorderSizePixel = 0
MinimizedButton.Text = "+"
MinimizedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizedButton.TextSize = 20
MinimizedButton.Visible = false
MinimizedButton.Parent = ScreenGui

local MinimizedCorner = Instance.new("UICorner")
MinimizedCorner.CornerRadius = UDim.new(0, 25)
MinimizedCorner.Parent = MinimizedButton

-- 变量
local ESPEnabled = false
local Flying = false
local FlySpeed = 50
local SpeedBoostEnabled = false
local WalkSpeed = 50
local BodyVelocity, BodyGyro
local ESPHighlights = {}
local CurrentPage = "HomePage"
local isAnimating = false
local SelectedPlayer = nil
local LockTeleportEnabled = false
local LockTeleportConnection = nil
local PlayerListExpanded = true
local OriginalWalkSpeed = 16
local SpeedBoostConnection = nil

-- 娱乐功能变量
local FunnyWalkEnabled = false
local FunnyWalkSpeed = 10
local FunnyWalkConnection = nil
local DanceEnabled = false
local SizeToggleEnabled = false
local SizeToggleConnection = nil
local RainbowEffectEnabled = false
local RainbowEffectConnection = nil
local OriginalSize = Vector3.new(1, 1, 1)

-- 修复的UI动画函数
local function createOpenAnimation()
    if isAnimating then return end
    isAnimating = true
    
    -- 先显示主容器，隐藏悬浮按钮
    MainContainer.Visible = true
    MinimizedButton.Visible = false
    
    -- 保存原始大小和位置
    local originalSize = UDim2.new(0, 600, 0, 500)
    local originalPosition = UDim2.new(0.5, -300, 0.5, -250)
    
    -- 获取悬浮按钮的位置和大小
    local buttonPos = MinimizedButton.AbsolutePosition
    local buttonSize = MinimizedButton.AbsoluteSize
    
    -- 计算初始状态（从悬浮按钮位置开始）
    local startSize = UDim2.new(0, buttonSize.X, 0, buttonSize.Y)
    local startPos = UDim2.new(0, buttonPos.X, 0, buttonPos.Y)
    
    -- 确保设置正确的初始状态
    MainContainer.Size = startSize
    MainContainer.Position = startPos
    
    -- 创建动画
    local sizeTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Size = originalSize}
    )
    
    local positionTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Position = originalPosition}
    )
    
    -- 播放动画
    sizeTween:Play()
    positionTween:Play()
    
    -- 动画完成后重置标志
    delay(0.3, function()
        isAnimating = false
    end)
end

local function createCloseAnimation()
    if isAnimating then return end
    isAnimating = true
    
    -- 获取目标状态（悬浮按钮的位置和大小）
    local targetSize = MinimizedButton.Size
    local targetPos = MinimizedButton.Position
    
    -- 创建动画
    local sizeTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Size = targetSize}
    )
    
    local positionTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Position = targetPos}
    )
    
    -- 播放动画
    sizeTween:Play()
    positionTween:Play()
    
    -- 动画完成后隐藏主容器，显示悬浮按钮
    delay(0.25, function()
        MainContainer.Visible = false
        MinimizedButton.Visible = true
        isAnimating = false
    end)
end

-- 页面切换函数
local function switchPage(pageName)
    for _, child in ipairs(ContentFrame:GetChildren()) do
        if child:IsA("Frame") then
            child.Visible = false
        end
    end
    
    if ContentFrame:FindFirstChild(pageName) then
        ContentFrame[pageName].Visible = true
        CurrentPage = pageName
        
        -- 如果切换到传送页面，更新玩家列表
        if pageName == "TeleportPage" then
            updatePlayerList()
        end
    end
end

-- 更新玩家列表
local function updatePlayerList()
    -- 清除现有玩家按钮
    for _, child in ipairs(PlayerScrollFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    -- 添加玩家按钮
    local players = Players:GetPlayers()
    local yOffset = 0
    
    for i, plr in ipairs(players) do
        if plr ~= player then
            local playerButton = Instance.new("TextButton")
            playerButton.Name = plr.Name .. "Button"
            playerButton.Size = UDim2.new(1, -10, 0, 30)
            playerButton.Position = UDim2.new(0, 5, 0, yOffset)
            playerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
            playerButton.BorderSizePixel = 0
            playerButton.Text = plr.Name
            playerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            playerButton.TextSize = 12
            playerButton.Font = Enum.Font.Gotham
            playerButton.Parent = PlayerScrollFrame
            
            local playerButtonCorner = Instance.new("UICorner")
            playerButtonCorner.CornerRadius = UDim.new(0, 6)
            playerButtonCorner.Parent = playerButton
            
            -- 点击选择玩家
            playerButton.MouseButton1Click:Connect(function()
                SelectedPlayer = plr
                SelectedPlayerLabel.Text = "已选择: " .. plr.Name
                
                -- 高亮选中的按钮
                for _, btn in ipairs(PlayerScrollFrame:GetChildren()) do
                    if btn:IsA("TextButton") then
                        if btn == playerButton then
                            btn.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
                        else
                            btn.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
                        end
                    end
                end
            end)
            
            yOffset = yOffset + 35
        end
    end
    
    -- 更新滚动区域大小
    PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

-- 传送功能
local function teleportToPlayer()
    if not SelectedPlayer or not SelectedPlayer.Character then
        return
    end
    
    local targetChar = SelectedPlayer.Character
    local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
    local playerChar = player.Character
    local playerRoot = playerChar and playerChar:FindFirstChild("HumanoidRootPart")
    
    if targetRoot and playerRoot then
        -- 传送到玩家旁边
        playerRoot.CFrame = targetRoot.CFrame + targetRoot.CFrame.LookVector * 5
    end
end

-- 锁定传送功能
local function toggleLockTeleport()
    LockTeleportEnabled = not LockTeleportEnabled
    
    if LockTeleportEnabled then
        LockTeleportButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        LockTeleportButton.Text = "锁定传送: 开启"
        
        -- 开始循环传送
        LockTeleportConnection = RunService.Heartbeat:Connect(function()
            if not SelectedPlayer or not SelectedPlayer.Character then
                return
            end
            
            local targetChar = SelectedPlayer.Character
            local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
            local playerChar = player.Character
            local playerRoot = playerChar and playerChar:FindFirstChild("HumanoidRootPart")
            
            if targetRoot and playerRoot then
                -- 传送到玩家头顶并面向玩家
                local offset = Vector3.new(0, 3, 0) -- 头顶偏移
                playerRoot.CFrame = CFrame.new(targetRoot.Position + offset, targetRoot.Position)
            end
        end)
    else
        LockTeleportButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        LockTeleportButton.Text = "锁定传送: 关闭"
        
        -- 停止循环传送
        if LockTeleportConnection then
            LockTeleportConnection:Disconnect()
            LockTeleportConnection = nil
        end
    end
end

-- 折叠/展开玩家列表
local function togglePlayerList()
    PlayerListExpanded = not PlayerListExpanded
    
    if PlayerListExpanded then
        PlayerListContainer.Size = UDim2.new(0.6, 0, 1, -10)
        ToggleListButton.Text = "◀"
        PlayerScrollFrame.Visible = true
    else
        PlayerListContainer.Size = UDim2.new(0, 150, 1, -10)
        ToggleListButton.Text = "▶"
        PlayerScrollFrame.Visible = false
    end
end

-- 透视功能
local function toggleESP()
    ESPEnabled = not ESPEnabled
    
    if ESPEnabled then
        ESPButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        ESPButton.Text = "透视: 开启"
        
        -- 为所有玩家添加高亮
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = plr.Character
                highlight.FillColor = Color3.fromRGB(255, 50, 50)
                highlight.FillTransparency = 0.9
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineTransparency = 0.2
                highlight.Parent = plr.Character
                ESPHighlights[plr] = highlight
            end
        end
    else
        ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        ESPButton.Text = "透视: 关闭"
        
        -- 移除所有高亮
        for plr, highlight in pairs(ESPHighlights) do
            if highlight then
                highlight:Destroy()
            end
        end
        ESPHighlights = {}
    end
end

-- 飞行功能 - 修复面向正面
local function toggleFly()
    Flying = not Flying
    
    if Flying then
        FlyButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        FlyButton.Text = "飞行: 开启"
        
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            BodyVelocity = Instance.new("BodyVelocity")
            BodyVelocity.Velocity = Vector3.new(0, 0, 0)
            BodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
            BodyVelocity.Parent = character.HumanoidRootPart
            
            BodyGyro = Instance.new("BodyGyro")
            BodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
            BodyGyro.P = 1000
            BodyGyro.Parent = character.HumanoidRootPart
            
            if character:FindFirstChild("Humanoid") then
                character.Humanoid.PlatformStand = true
            end
        end
    else
        FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        FlyButton.Text = "飞行: 关闭"
        
        if BodyVelocity then 
            BodyVelocity:Destroy()
            BodyVelocity = nil
        end
        if BodyGyro then 
            BodyGyro:Destroy() 
            BodyGyro = nil
        end
        
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.PlatformStand = false
        end
    end
end

-- 移动加速功能 - 修复版
local function toggleSpeedBoost()
    SpeedBoostEnabled = not SpeedBoostEnabled
    
    if SpeedBoostEnabled then
        SpeedBoostButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        SpeedBoostButton.Text = "移动加速: 开启"
        
        -- 保存原始速度
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            OriginalWalkSpeed = character.Humanoid.WalkSpeed
            character.Humanoid.WalkSpeed = WalkSpeed
        end
        
        -- 创建持续更新速度的连接
        SpeedBoostConnection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            if character and character:FindFirstChild("Humanoid") then
                -- 持续设置速度，防止被游戏重置
                character.Humanoid.WalkSpeed = WalkSpeed
            end
        end)
    else
        SpeedBoostButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        SpeedBoostButton.Text = "移动加速: 关闭"
        
        -- 停止持续更新
        if SpeedBoostConnection then
            SpeedBoostConnection:Disconnect()
            SpeedBoostConnection = nil
        end
        
        -- 恢复原始速度
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.WalkSpeed = OriginalWalkSpeed
        end
    end
end

-- 滑稽走路功能 - 超快动画但实际速度慢
local function toggleFunnyWalk()
    FunnyWalkEnabled = not FunnyWalkEnabled
    
    if FunnyWalkEnabled then
        FunnyWalkButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        FunnyWalkButton.Text = "滑稽走路: 开启"
        
        -- 创建滑稽走路效果
        FunnyWalkConnection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            if character and character:FindFirstChild("Humanoid") then
                -- 设置超快的走路动画速度
                character.Humanoid.WalkSpeed = 8  -- 实际移动速度慢
                
                -- 尝试修改动画速度（如果可能）
                local animate = character:FindFirstChild("Animate")
                if animate then
                    local walkAnimation = animate:FindFirstChild("walk")
                    if walkAnimation then
                        local animationTrack = walkAnimation:FindFirstChildOfClass("AnimationTrack")
                        if animationTrack then
                            animationTrack:AdjustSpeed(FunnyWalkSpeed)  -- 超快的动画速度
                        end
                    end
                end
            end
        end)
    else
        FunnyWalkButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        FunnyWalkButton.Text = "滑稽走路: 关闭"
        
        -- 停止滑稽走路
        if FunnyWalkConnection then
            FunnyWalkConnection:Disconnect()
            FunnyWalkConnection = nil
        end
        
        -- 恢复正常走路
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.WalkSpeed = OriginalWalkSpeed
            
            -- 恢复动画速度
            local animate = character:FindFirstChild("Animate")
            if animate then
                local walkAnimation = animate:FindFirstChild("walk")
                if walkAnimation then
                    local animationTrack = walkAnimation:FindFirstChildOfClass("AnimationTrack")
                    if animationTrack then
                        animationTrack:AdjustSpeed(1)  -- 恢复正常动画速度
                    end
                end
            end
        end
    end
end

-- 跳舞功能
local function toggleDance()
    DanceEnabled = not DanceEnabled
    
    if DanceEnabled then
        DanceButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        DanceButton.Text = "跳舞: 开启"
        
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            -- 创建跳舞动画
            local danceAnimation = Instance.new("Animation")
            danceAnimation.AnimationId = "rbxassetid://33796059"  -- 跳舞动画ID
            
            local danceTrack = character.Humanoid:LoadAnimation(danceAnimation)
            danceTrack:Play()
            danceTrack.Looped = true
            
            -- 保存跳舞轨道以便停止
            DanceButton.DanceTrack = danceTrack
        end
    else
        DanceButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        DanceButton.Text = "跳舞: 关闭"
        
        -- 停止跳舞
        if DanceButton.DanceTrack then
            DanceButton.DanceTrack:Stop()
            DanceButton.DanceTrack = nil
        end
    end
end

-- 变大变小功能
local function toggleSize()
    SizeToggleEnabled = not SizeToggleEnabled
    
    if SizeToggleEnabled then
        SizeToggleButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        SizeToggleButton.Text = "变大变小: 开启"
        
        -- 保存原始大小
        local character = player.Character
        if character then
            OriginalSize = character:GetScale()
        end
        
        -- 开始循环变大变小
        local scaleDirection = 1  -- 1表示变大，-1表示变小
        SizeToggleConnection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            if character then
                -- 计算新大小
                local currentScale = character:GetScale()
                local newScale = currentScale + (scaleDirection * 0.05)
                
                -- 限制大小范围
                if newScale > 3 then
                    newScale = 3
                    scaleDirection = -1  -- 开始变小
                elseif newScale < 0.5 then
                    newScale = 0.5
                    scaleDirection = 1   -- 开始变大
                end
                
                -- 应用新大小
                character:ScaleTo(newScale)
            end
        end)
    else
        SizeToggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        SizeToggleButton.Text = "变大变小: 关闭"
        
        -- 停止大小变化
        if SizeToggleConnection then
            SizeToggleConnection:Disconnect()
            SizeToggleConnection = nil
        end
        
        -- 恢复原始大小
        local character = player.Character
        if character then
            character:ScaleTo(OriginalSize)
        end
    end
end

-- 彩虹特效功能
local function toggleRainbowEffect()
    RainbowEffectEnabled = not RainbowEffectEnabled
    
    if RainbowEffectEnabled then
        RainbowEffectButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        RainbowEffectButton.Text = "彩虹特效: 开启"
        
        -- 创建彩虹特效
        local hue = 0
        RainbowEffectConnection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            if character then
                -- 循环改变色调
                hue = (hue + 0.01) % 1
                local color = Color3.fromHSV(hue, 1, 1)
                
                -- 为角色添加彩虹光效
                for _, part in pairs(character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.Color = color
                        
                        -- 添加发光效果
                        local glow = part:FindFirstChild("RainbowGlow") or Instance.new("SurfaceLight")
                        glow.Name = "RainbowGlow"
                        glow.Color = color
                        glow.Brightness = 2
                        glow.Range = 10
                        glow.Parent = part
                    end
                end
            end
        end)
    else
        RainbowEffectButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        RainbowEffectButton.Text = "彩虹特效: 关闭"
        
        -- 停止彩虹特效
        if RainbowEffectConnection then
            RainbowEffectConnection:Disconnect()
            RainbowEffectConnection = nil
        end
        
        -- 移除特效
        local character = player.Character
        if character then
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.Color = Color3.fromRGB(1, 1, 1)  -- 恢复默认颜色
                    
                    -- 移除发光效果
                    local glow = part:FindFirstChild("RainbowGlow")
                    if glow then
                        glow:Destroy()
                    end
                end
            end
        end
    end
end

-- 更新滑稽走路速度滑块
local function updateFunnyWalkSpeedSlider()
    local ratio = FunnyWalkSpeed / 50  -- 最大50
    FunnyWalkSliderFill.Size = UDim2.new(ratio, 0, 1, 0)
    FunnyWalkSpeedLabel.Text = "走路动画速度: " .. FunnyWalkSpeed
end

-- 飞行控制 - 修复面向正面
local lastUpdate = 0
local function updateFly()
    if not Flying or not BodyVelocity or not BodyGyro then return end
    
    -- 限制更新频率
    local now = tick()
    if now - lastUpdate < 0.016 then return end
    lastUpdate = now
    
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = character.HumanoidRootPart
    
    -- 获取相机方向
    local camCFrame = camera.CFrame
    local lookVector = camCFrame.LookVector
    local rightVector = camCFrame.RightVector
    local upVector = Vector3.new(0, 1, 0)
    
    -- 计算移动方向
    local moveDirection = Vector3.new()
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then 
        moveDirection = moveDirection + lookVector  -- 向前移动（面向镜头方向）
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then 
        moveDirection = moveDirection - lookVector  -- 向后移动（背对镜头方向）
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then 
        moveDirection = moveDirection - rightVector  -- 向左移动
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then 
        moveDirection = moveDirection + rightVector  -- 向右移动
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then 
        moveDirection = moveDirection + upVector  -- 上升
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then 
        moveDirection = moveDirection - upVector  -- 下降
    end
    
    -- 修复：让人物真正面向镜头方向
    -- 使用相机的CFrame但保持人物原本的Y轴旋转
    local targetCFrame = CFrame.new(root.Position, root.Position + lookVector)
    BodyGyro.CFrame = targetCFrame
    
    -- 应用速度
    if moveDirection.Magnitude > 0 then
        BodyVelocity.Velocity = moveDirection.Unit * FlySpeed
    else
        BodyVelocity.Velocity = Vector3.new(0, 0, 0)
    end
end

-- 更新飞行速度滑块
local function updateSpeedSlider()
    local ratio = FlySpeed / 100
    SliderFill.Size = UDim2.new(ratio, 0, 1, 0)
    SpeedLabel.Text = "飞行速度: " .. FlySpeed
end

-- 更新移动速度滑块
local function updateWalkSpeedSlider()
    local ratio = WalkSpeed / 500  -- 最大500
    WalkSliderFill.Size = UDim2.new(ratio, 0, 1, 0)
    WalkSpeedLabel.Text = "移动速度: " .. WalkSpeed
    
    -- 如果加速开启，立即应用新速度
    if SpeedBoostEnabled then
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.WalkSpeed = WalkSpeed
        end
    end
end

-- 重置UI位置
local function resetUIPosition()
    MainContainer.Position = UDim2.new(0.5, -300, 0.5, -250)
    MinimizedButton.Position = UDim2.new(0, 10, 0, 10)
end

-- 隐藏UI
local function hideUI()
    ScreenGui.Enabled = false
end

-- 事件处理
MinimizeButton.MouseButton1Click:Connect(createCloseAnimation)
MinimizedButton.MouseButton1Click:Connect(createOpenAnimation)

-- 导航按钮点击
for _, button in ipairs(NavContainer:GetChildren()) do
    if button:IsA("TextButton") then
        button.MouseButton1Click:Connect(function()
            if button.Text == "主页" then
                switchPage("HomePage")
            elseif button.Text == "功能" then
                switchPage("FunctionsPage")
            elseif button.Text == "传送" then
                switchPage("TeleportPage")
            elseif button.Text == "娱乐" then
                switchPage("EntertainmentPage")
            elseif button.Text == "设置" then
                switchPage("SettingsPage")
            end
        end)
    end
end

-- 功能按钮
ESPButton.MouseButton1Click:Connect(toggleESP)
FlyButton.MouseButton1Click:Connect(toggleFly)
SpeedBoostButton.MouseButton1Click:Connect(toggleSpeedBoost)

-- 娱乐功能按钮
FunnyWalkButton.MouseButton1Click:Connect(toggleFunnyWalk)
DanceButton.MouseButton1Click:Connect(toggleDance)
SizeToggleButton.MouseButton1Click:Connect(toggleSize)
RainbowEffectButton.MouseButton1Click:Connect(toggleRainbowEffect)

-- 传送功能按钮
TeleportButton.MouseButton1Click:Connect(teleportToPlayer)
LockTeleportButton.MouseButton1Click:Connect(toggleLockTeleport)
ToggleListButton.MouseButton1Click:Connect(togglePlayerList)

-- 设置按钮
ResetUIButton.MouseButton1Click:Connect(resetUIPosition)
HideUIButton.MouseButton1Click:Connect(hideUI)

-- 飞行速度滑块控制
SliderButton.MouseButton1Down:Connect(function()
    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = UserInputService:GetMouseLocation()
            local sliderPos = SpeedSlider.AbsolutePosition.X
            local sliderSize = SpeedSlider.AbsoluteSize.X
            
            local x = math.clamp(mousePos.X - sliderPos, 0, sliderSize)
            local ratio = x / sliderSize
            FlySpeed = math.floor(ratio * 100)
            updateSpeedSlider()
        end
    end)
    
    local endConnection
    endConnection = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
            endConnection:Disconnect()
        end
    end)
end)

-- 移动速度滑块控制
WalkSliderButton.MouseButton1Down:Connect(function()
    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = UserInputService:GetMouseLocation()
            local sliderPos = WalkSpeedSlider.AbsolutePosition.X
            local sliderSize = WalkSpeedSlider.AbsoluteSize.X
            
            local x = math.clamp(mousePos.X - sliderPos, 0, sliderSize)
            local ratio = x / sliderSize
            WalkSpeed = math.floor(ratio * 500)  -- 最大500
            updateWalkSpeedSlider()
        end
    end)
    
    local endConnection
    endConnection = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
            endConnection:Disconnect()
        end
    end)
end)

-- 滑稽走路速度滑块控制
FunnyWalkSliderButton.MouseButton1Down:Connect(function()
    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = UserInputService:GetMouseLocation()
            local sliderPos = FunnyWalkSpeedSlider.AbsolutePosition.X
            local sliderSize = FunnyWalkSpeedSlider.AbsoluteSize.X
            
            local x = math.clamp(mousePos.X - sliderPos, 0, sliderSize)
            local ratio = x / sliderSize
            FunnyWalkSpeed = math.floor(ratio * 50)  -- 最大50
            updateFunnyWalkSpeedSlider()
            
            -- 如果滑稽走路已开启，立即应用新速度
            if FunnyWalkEnabled then
                local character = player.Character
                if character and character:FindFirstChild("Animate") then
                    local animate = character.Animate
                    local walkAnimation = animate:FindFirstChild("walk")
                    if walkAnimation then
                        local animationTrack = walkAnimation:FindFirstChildOfClass("AnimationTrack")
                        if animationTrack then
                            animationTrack:AdjustSpeed(FunnyWalkSpeed)
                        end
                    end
                end
            end
        end
    end)
    
    local endConnection
    endConnection = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
            endConnection:Disconnect()
        end
    end)
end)

-- 悬浮窗按钮拖动
local dragging = false
local dragStart, startPos

MinimizedButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MinimizedButton.Position
    end
end)

MinimizedButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        local newX = math.clamp(startPos.X.Offset + delta.X, 0, ScreenGui.AbsoluteSize.X - MinimizedButton.AbsoluteSize.X)
        local newY = math.clamp(startPos.Y.Offset + delta.Y, 0, ScreenGui.AbsoluteSize.Y - MinimizedButton.AbsoluteSize.Y)
        MinimizedButton.Position = UDim2.new(0, newX, 0, newY)
    end
end)

-- 玩家处理
Players.PlayerAdded:Connect(function(plr)
    if ESPEnabled and plr.Character then
        spawn(function()
            wait(0.1)
            if ESPEnabled and plr.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = plr.Character
                highlight.FillColor = Color3.fromRGB(255, 50, 50)
                highlight.FillTransparency = 0.9
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineTransparency = 0.2
                highlight.Parent = plr.Character
                ESPHighlights[plr] = highlight
            end
        end)
    end
    
    -- 更新玩家列表
    if CurrentPage == "TeleportPage" then
        updatePlayerList()
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if ESPHighlights[plr] then
        ESPHighlights[plr]:Destroy()
        ESPHighlights[plr] = nil
    end
    
    -- 如果选中的玩家离开，清除选择
    if SelectedPlayer == plr then
        SelectedPlayer = nil
        SelectedPlayerLabel.Text = "未选择玩家"
    end
    
    -- 更新玩家列表
    if CurrentPage == "TeleportPage" then
        updatePlayerList()
    end
end)

-- 角色重生处理 - 修复所有状态
player.CharacterAdded:Connect(function(character)
    -- 等待角色完全加载
    wait(1)
    
    -- 重新应用飞行状态
    if Flying then
        local wasFlying = Flying
        Flying = false
        FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        FlyButton.Text = "飞行: 关闭"
        
        wait(0.1)
        
        Flying = true
        FlyButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        FlyButton.Text = "飞行: 开启"
        
        -- 重新创建飞行组件
        if character and character:FindFirstChild("HumanoidRootPart") then
            BodyVelocity = Instance.new("BodyVelocity")
            BodyVelocity.Velocity = Vector3.new(0, 0, 0)
            BodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
            BodyVelocity.Parent = character.HumanoidRootPart
            
            BodyGyro = Instance.new("BodyGyro")
            BodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
            BodyGyro.P = 1000
            BodyGyro.Parent = character.HumanoidRootPart
            
            if character:FindFirstChild("Humanoid") then
                character.Humanoid.PlatformStand = true
            end
        end
    end
    
    -- 重新应用透视状态
    if ESPEnabled then
        local wasESP = ESPEnabled
        ESPEnabled = false
        ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        ESPButton.Text = "透视: 关闭"
        
        wait(0.1)
        
        ESPEnabled = true
        ESPButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        ESPButton.Text = "透视: 开启"
        
        -- 为所有玩家重新添加高亮
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = plr.Character
                highlight.FillColor = Color3.fromRGB(255, 50, 50)
                highlight.FillTransparency = 0.9
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineTransparency = 0.2
                highlight.Parent = plr.Character
                ESPHighlights[plr] = highlight
            end
        end
    end
    
    -- 重新应用移动加速
    if SpeedBoostEnabled then
        -- 保存原始速度
        if character and character:FindFirstChild("Humanoid") then
            OriginalWalkSpeed = character.Humanoid.WalkSpeed
            character.Humanoid.WalkSpeed = WalkSpeed
        end
    end
    
    -- 重新应用娱乐功能
    if FunnyWalkEnabled then
        toggleFunnyWalk()
        toggleFunnyWalk()
    end
    
    if DanceEnabled then
        toggleDance()
        toggleDance()
    end
    
    if SizeToggleEnabled then
        toggleSize()
        toggleSize()
    end
    
    if RainbowEffectEnabled then
        toggleRainbowEffect()
        toggleRainbowEffect()
    end
end)

-- 初始化
updateSpeedSlider()
updateWalkSpeedSlider()
updateFunnyWalkSpeedSlider()

-- 飞行更新循环
RunService.Heartbeat:Connect(updateFly)

print("娱乐功能版GUI加载完成！新增了4个娱乐功能。")
]]))

if not success then
    warn("脚本加载错误: " .. tostring(err))
else
    print("脚本成功加载！")
end
