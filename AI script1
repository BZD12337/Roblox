local loadstring = loadstring or load
local success, err = pcall(loadstring([[
-- 娱乐功能脚本
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- 检测注入器名称
local injectorName = "未知注入器"
pcall(function()
    if syn then injectorName = "Synapse X" end
    if getexecutorname then injectorName = getexecutorname() or "KRNL" end
    if identifyexecutor then injectorName = identifyexecutor() or "ScriptWare" end
end)

-- 创建主UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "EntertainmentGUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = CoreGui

-- 主容器
local MainContainer = Instance.new("Frame")
MainContainer.Name = "MainContainer"
MainContainer.Size = UDim2.new(0, 600, 0, 550)
MainContainer.Position = UDim2.new(0.5, -300, 0.5, -275)
MainContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainContainer.BorderSizePixel = 0
MainContainer.Visible = true
MainContainer.Active = true
MainContainer.Draggable = true
MainContainer.Parent = ScreenGui

-- 圆角
local ContainerCorner = Instance.new("UICorner")
ContainerCorner.CornerRadius = UDim.new(0, 8)
ContainerCorner.Parent = MainContainer

-- 标题栏（用于拖动）
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainContainer

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

-- 标题文本
local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(1, -60, 1, 0)
TitleText.Position = UDim2.new(0, 10, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "控制面板"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.TextSize = 14
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Font = Enum.Font.GothamBold
TitleText.Parent = TitleBar

-- 侧边栏
local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 120, 1, -30)
Sidebar.Position = UDim2.new(0, 0, 0, 30)
Sidebar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
Sidebar.BorderSizePixel = 0
Sidebar.Parent = MainContainer

-- 导航按钮
local NavButtons = {"主页", "功能", "传送", "其他脚本", "设置"}

local NavContainer = Instance.new("Frame")
NavContainer.Name = "NavContainer"
NavContainer.Size = UDim2.new(1, 0, 1, 0)
NavContainer.Position = UDim2.new(0, 0, 0, 0)
NavContainer.BackgroundTransparency = 1
NavContainer.Parent = Sidebar

-- 创建导航按钮
for i, name in ipairs(NavButtons) do
    local button = Instance.new("TextButton")
    button.Name = name .. "Button"
    button.Size = UDim2.new(1, -10, 0, 32)
    button.Position = UDim2.new(0, 5, 0, 10 + (i-1) * 37)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    button.BorderSizePixel = 0
    button.Text = name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 12
    button.Font = Enum.Font.Gotham
    button.Parent = NavContainer
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button
end

-- 主内容区域
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -120, 1, -30)
ContentFrame.Position = UDim2.new(0, 120, 0, 30)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainContainer

-- 主页内容
local HomePage = Instance.new("Frame")
HomePage.Name = "HomePage"
HomePage.Size = UDim2.new(1, 0, 1, 0)
HomePage.BackgroundTransparency = 1
HomePage.Visible = true
HomePage.Parent = ContentFrame

-- 用户信息
local UserInfo = Instance.new("Frame")
UserInfo.Name = "UserInfo"
UserInfo.Size = UDim2.new(1, -20, 0, 80)
UserInfo.Position = UDim2.new(0, 10, 0, 10)
UserInfo.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
UserInfo.BorderSizePixel = 0
UserInfo.Parent = HomePage

local UserCorner = Instance.new("UICorner")
UserCorner.CornerRadius = UDim.new(0, 8)
UserCorner.Parent = UserInfo

-- 用户信息显示
local UserText = Instance.new("TextLabel")
UserText.Name = "UserText"
UserText.Size = UDim2.new(1, -10, 1, -10)
UserText.Position = UDim2.new(0, 5, 0, 5)
UserText.BackgroundTransparency = 1
UserText.Text = "用户: " .. player.Name .. "\n注入器: " .. injectorName
UserText.TextColor3 = Color3.fromRGB(255, 255, 255)
UserText.TextSize = 14
UserText.TextXAlignment = Enum.TextXAlignment.Left
UserText.TextYAlignment = Enum.TextYAlignment.Top
UserText.Font = Enum.Font.Gotham
UserText.Parent = UserInfo

-- 功能页面
local FunctionsPage = Instance.new("Frame")
FunctionsPage.Name = "FunctionsPage"
FunctionsPage.Size = UDim2.new(1, 0, 1, 0)
FunctionsPage.BackgroundTransparency = 1
FunctionsPage.Visible = false
FunctionsPage.Parent = ContentFrame

-- 透视功能
local ESPButton = Instance.new("TextButton")
ESPButton.Name = "ESPButton"
ESPButton.Size = UDim2.new(0.45, 0, 0, 35)
ESPButton.Position = UDim2.new(0.025, 0, 0, 10)
ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
ESPButton.BorderSizePixel = 0
ESPButton.Text = "透视: 关闭"
ESPButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPButton.TextSize = 14
ESPButton.Font = Enum.Font.Gotham
ESPButton.Parent = FunctionsPage

local ESPCorner = Instance.new("UICorner")
ESPCorner.CornerRadius = UDim.new(0, 6)
ESPCorner.Parent = ESPButton

-- 飞行功能
local FlyButton = Instance.new("TextButton")
FlyButton.Name = "FlyButton"
FlyButton.Size = UDim2.new(0.45, 0, 0, 35)
FlyButton.Position = UDim2.new(0.525, 0, 0, 10)
FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
FlyButton.BorderSizePixel = 0
FlyButton.Text = "飞行: 关闭"
FlyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyButton.TextSize = 14
FlyButton.Font = Enum.Font.Gotham
FlyButton.Parent = FunctionsPage

local FlyCorner = Instance.new("UICorner")
FlyCorner.CornerRadius = UDim.new(0, 6)
FlyCorner.Parent = FlyButton

-- 飞行速度滑块
local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Name = "SpeedLabel"
SpeedLabel.Size = UDim2.new(1, -20, 0, 20)
SpeedLabel.Position = UDim2.new(0, 10, 0, 60)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Text = "飞行速度: 500"
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedLabel.TextSize = 14
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.Parent = FunctionsPage

local SpeedSlider = Instance.new("Frame")
SpeedSlider.Name = "SpeedSlider"
SpeedSlider.Size = UDim2.new(1, -20, 0, 15)
SpeedSlider.Position = UDim2.new(0, 10, 0, 85)
SpeedSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
SpeedSlider.BorderSizePixel = 0
SpeedSlider.Parent = FunctionsPage

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(0, 7)
SliderCorner.Parent = SpeedSlider

local SliderFill = Instance.new("Frame")
SliderFill.Name = "SliderFill"
SliderFill.Size = UDim2.new(0.5, 0, 1, 0)
SliderFill.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
SliderFill.BorderSizePixel = 0
SliderFill.Parent = SpeedSlider

local FillCorner = Instance.new("UICorner")
FillCorner.CornerRadius = UDim.new(0, 7)
FillCorner.Parent = SliderFill

local SliderButton = Instance.new("TextButton")
SliderButton.Name = "SliderButton"
SliderButton.Size = UDim2.new(1, 0, 1, 0)
SliderButton.BackgroundTransparency = 1
SliderButton.Text = ""
SliderButton.Parent = SpeedSlider

-- 移动速度功能
local SpeedBoostButton = Instance.new("TextButton")
SpeedBoostButton.Name = "SpeedBoostButton"
SpeedBoostButton.Size = UDim2.new(0.45, 0, 0, 35)
SpeedBoostButton.Position = UDim2.new(0.025, 0, 0, 120)
SpeedBoostButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
SpeedBoostButton.BorderSizePixel = 0
SpeedBoostButton.Text = "移动加速: 关闭"
SpeedBoostButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedBoostButton.TextSize = 14
SpeedBoostButton.Font = Enum.Font.Gotham
SpeedBoostButton.Parent = FunctionsPage

local SpeedBoostCorner = Instance.new("UICorner")
SpeedBoostCorner.CornerRadius = UDim.new(0, 6)
SpeedBoostCorner.Parent = SpeedBoostButton

-- 移动速度滑块
local WalkSpeedLabel = Instance.new("TextLabel")
WalkSpeedLabel.Name = "WalkSpeedLabel"
WalkSpeedLabel.Size = UDim2.new(1, -20, 0, 20)
WalkSpeedLabel.Position = UDim2.new(0, 10, 0, 170)
WalkSpeedLabel.BackgroundTransparency = 1
WalkSpeedLabel.Text = "移动速度: 50"
WalkSpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
WalkSpeedLabel.TextSize = 14
WalkSpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
WalkSpeedLabel.Font = Enum.Font.Gotham
WalkSpeedLabel.Parent = FunctionsPage

local WalkSpeedSlider = Instance.new("Frame")
WalkSpeedSlider.Name = "WalkSpeedSlider"
WalkSpeedSlider.Size = UDim2.new(1, -20, 0, 15)
WalkSpeedSlider.Position = UDim2.new(0, 10, 0, 195)
WalkSpeedSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
WalkSpeedSlider.BorderSizePixel = 0
WalkSpeedSlider.Parent = FunctionsPage

local WalkSliderCorner = Instance.new("UICorner")
WalkSliderCorner.CornerRadius = UDim.new(0, 7)
WalkSliderCorner.Parent = WalkSpeedSlider

local WalkSliderFill = Instance.new("Frame")
WalkSliderFill.Name = "WalkSliderFill"
WalkSliderFill.Size = UDim2.new(0.1, 0, 1, 0)
WalkSliderFill.BackgroundColor3 = Color3.fromRGB(80, 255, 160)
WalkSliderFill.BorderSizePixel = 0
WalkSliderFill.Parent = WalkSpeedSlider

local WalkFillCorner = Instance.new("UICorner")
WalkFillCorner.CornerRadius = UDim.new(0, 7)
WalkFillCorner.Parent = WalkSliderFill

local WalkSliderButton = Instance.new("TextButton")
WalkSliderButton.Name = "WalkSliderButton"
WalkSliderButton.Size = UDim2.new(1, 0, 1, 0)
WalkSliderButton.BackgroundTransparency = 1
WalkSliderButton.Text = ""
WalkSliderButton.Parent = WalkSpeedSlider

-- 传送功能页面
local TeleportPage = Instance.new("Frame")
TeleportPage.Name = "TeleportPage"
TeleportPage.Size = UDim2.new(1, 0, 1, 0)
TeleportPage.BackgroundTransparency = 1
TeleportPage.Visible = false
TeleportPage.Parent = ContentFrame

-- 玩家列表容器
local PlayerListContainer = Instance.new("Frame")
PlayerListContainer.Name = "PlayerListContainer"
PlayerListContainer.Size = UDim2.new(0.6, 0, 1, -10)
PlayerListContainer.Position = UDim2.new(0, 0, 0, 5)
PlayerListContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
PlayerListContainer.BorderSizePixel = 0
PlayerListContainer.Parent = TeleportPage

local PlayerListCorner = Instance.new("UICorner")
PlayerListCorner.CornerRadius = UDim.new(0, 8)
PlayerListCorner.Parent = PlayerListContainer

-- 玩家列表标题
local PlayerListTitle = Instance.new("TextLabel")
PlayerListTitle.Name = "PlayerListTitle"
PlayerListTitle.Size = UDim2.new(1, 0, 0, 30)
PlayerListTitle.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
PlayerListTitle.BorderSizePixel = 0
PlayerListTitle.Text = "玩家列表"
PlayerListTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerListTitle.TextSize = 14
PlayerListTitle.Font = Enum.Font.GothamBold
PlayerListTitle.Parent = PlayerListContainer

local PlayerListTitleCorner = Instance.new("UICorner")
PlayerListTitleCorner.CornerRadius = UDim.new(0, 8)
PlayerListTitleCorner.Parent = PlayerListTitle

-- 折叠按钮
local ToggleListButton = Instance.new("TextButton")
ToggleListButton.Name = "ToggleListButton"
ToggleListButton.Size = UDim2.new(0, 30, 0, 30)
ToggleListButton.Position = UDim2.new(1, -35, 0, 0)
ToggleListButton.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
ToggleListButton.BorderSizePixel = 0
ToggleListButton.Text = "◀"
ToggleListButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleListButton.TextSize = 14
ToggleListButton.Parent = PlayerListTitle

local ToggleListCorner = Instance.new("UICorner")
ToggleListCorner.CornerRadius = UDim.new(0, 6)
ToggleListCorner.Parent = ToggleListButton

-- 玩家列表滚动框
local PlayerScrollFrame = Instance.new("ScrollingFrame")
PlayerScrollFrame.Name = "PlayerScrollFrame"
PlayerScrollFrame.Size = UDim2.new(1, -10, 1, -40)
PlayerScrollFrame.Position = UDim2.new(0, 5, 0, 35)
PlayerScrollFrame.BackgroundTransparency = 1
PlayerScrollFrame.BorderSizePixel = 0
PlayerScrollFrame.ScrollBarThickness = 5
PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayerScrollFrame.Parent = PlayerListContainer

-- 传送控制区域
local TeleportControlContainer = Instance.new("Frame")
TeleportControlContainer.Name = "TeleportControlContainer"
TeleportControlContainer.Size = UDim2.new(0.35, 0, 1, -10)
TeleportControlContainer.Position = UDim2.new(0.65, 0, 0, 5)
TeleportControlContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
TeleportControlContainer.BorderSizePixel = 0
TeleportControlContainer.Parent = TeleportPage

local TeleportControlCorner = Instance.new("UICorner")
TeleportControlCorner.CornerRadius = UDim.new(0, 8)
TeleportControlCorner.Parent = TeleportControlContainer

-- 传送按钮
local TeleportButton = Instance.new("TextButton")
TeleportButton.Name = "TeleportButton"
TeleportButton.Size = UDim2.new(1, -20, 0, 40)
TeleportButton.Position = UDim2.new(0, 10, 0, 20)
TeleportButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
TeleportButton.BorderSizePixel = 0
TeleportButton.Text = "传送到玩家"
TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportButton.TextSize = 14
TeleportButton.Font = Enum.Font.Gotham
TeleportButton.Parent = TeleportControlContainer

local TeleportCorner = Instance.new("UICorner")
TeleportCorner.CornerRadius = UDim.new(0, 6)
TeleportCorner.Parent = TeleportButton

-- 锁定传送按钮
local LockTeleportButton = Instance.new("TextButton")
LockTeleportButton.Name = "LockTeleportButton"
LockTeleportButton.Size = UDim2.new(1, -20, 0, 40)
LockTeleportButton.Position = UDim2.new(0, 10, 0, 70)
LockTeleportButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
LockTeleportButton.BorderSizePixel = 0
LockTeleportButton.Text = "锁定传送: 关闭"
LockTeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LockTeleportButton.TextSize = 14
LockTeleportButton.Font = Enum.Font.Gotham
LockTeleportButton.Parent = TeleportControlContainer

local LockTeleportCorner = Instance.new("UICorner")
LockTeleportCorner.CornerRadius = UDim.new(0, 6)
LockTeleportCorner.Parent = LockTeleportButton

-- 甩飞按钮
local LaunchButton = Instance.new("TextButton")
LaunchButton.Name = "LaunchButton"
LaunchButton.Size = UDim2.new(1, -20, 0, 40)
LaunchButton.Position = UDim2.new(0, 10, 0, 120)
LaunchButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
LaunchButton.BorderSizePixel = 0
LaunchButton.Text = "甩飞"
LaunchButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LaunchButton.TextSize = 14
LaunchButton.Font = Enum.Font.Gotham
LaunchButton.Parent = TeleportControlContainer

local LaunchCorner = Instance.new("UICorner")
LaunchCorner.CornerRadius = UDim.new(0, 6)
LaunchCorner.Parent = LaunchButton

-- 锁定甩飞按钮
local LockLaunchButton = Instance.new("TextButton")
LockLaunchButton.Name = "LockLaunchButton"
LockLaunchButton.Size = UDim2.new(1, -20, 0, 40)
LockLaunchButton.Position = UDim2.new(0, 10, 0, 170)
LockLaunchButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
LockLaunchButton.BorderSizePixel = 0
LockLaunchButton.Text = "锁定甩飞: 关闭"
LockLaunchButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LockLaunchButton.TextSize = 14
LockLaunchButton.Font = Enum.Font.Gotham
LockLaunchButton.Parent = TeleportControlContainer

local LockLaunchCorner = Instance.new("UICorner")
LockLaunchCorner.CornerRadius = UDim.new(0, 6)
LockLaunchCorner.Parent = LockLaunchButton

-- 选中的玩家显示
local SelectedPlayerLabel = Instance.new("TextLabel")
SelectedPlayerLabel.Name = "SelectedPlayerLabel"
SelectedPlayerLabel.Size = UDim2.new(1, -20, 0, 40)
SelectedPlayerLabel.Position = UDim2.new(0, 10, 0, 220)
SelectedPlayerLabel.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
SelectedPlayerLabel.BorderSizePixel = 0
SelectedPlayerLabel.Text = "未选择玩家"
SelectedPlayerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SelectedPlayerLabel.TextSize = 14
SelectedPlayerLabel.Font = Enum.Font.Gotham
SelectedPlayerLabel.Parent = TeleportControlContainer

local SelectedPlayerCorner = Instance.new("UICorner")
SelectedPlayerCorner.CornerRadius = UDim.new(0, 6)
SelectedPlayerCorner.Parent = SelectedPlayerLabel

-- 其他脚本页面
local OtherScriptsPage = Instance.new("Frame")
OtherScriptsPage.Name = "OtherScriptsPage"
OtherScriptsPage.Size = UDim2.new(1, 0, 1, 0)
OtherScriptsPage.BackgroundTransparency = 1
OtherScriptsPage.Visible = false
OtherScriptsPage.Parent = ContentFrame

-- 其他脚本标题
local OtherScriptsTitle = Instance.new("TextLabel")
OtherScriptsTitle.Name = "OtherScriptsTitle"
OtherScriptsTitle.Size = UDim2.new(1, -20, 0, 30)
OtherScriptsTitle.Position = UDim2.new(0, 10, 0, 10)
OtherScriptsTitle.BackgroundTransparency = 1
OtherScriptsTitle.Text = "其他脚本"
OtherScriptsTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
OtherScriptsTitle.TextSize = 18
OtherScriptsTitle.TextXAlignment = Enum.TextXAlignment.Left
OtherScriptsTitle.Font = Enum.Font.GothamBold
OtherScriptsTitle.Parent = OtherScriptsPage

-- 皮脚本按钮
local PiScriptButton = Instance.new("TextButton")
PiScriptButton.Name = "PiScriptButton"
PiScriptButton.Size = UDim2.new(0.8, 0, 0, 35)
PiScriptButton.Position = UDim2.new(0.1, 0, 0.2, 0)
PiScriptButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
PiScriptButton.BorderSizePixel = 0
PiScriptButton.Text = "皮脚本"
PiScriptButton.TextColor3 = Color3.fromRGB(255, 255, 255)
PiScriptButton.TextSize = 14
PiScriptButton.Font = Enum.Font.Gotham
PiScriptButton.Parent = OtherScriptsPage

local PiScriptCorner = Instance.new("UICorner")
PiScriptCorner.CornerRadius = UDim.new(0, 6)
PiScriptCorner.Parent = PiScriptButton

-- 设置页面
local SettingsPage = Instance.new("Frame")
SettingsPage.Name = "SettingsPage"
SettingsPage.Size = UDim2.new(1, 0, 1, 0)
SettingsPage.BackgroundTransparency = 1
SettingsPage.Visible = false
SettingsPage.Parent = ContentFrame

-- 设置标题
local SettingsTitle = Instance.new("TextLabel")
SettingsTitle.Name = "SettingsTitle"
SettingsTitle.Size = UDim2.new(1, -20, 0, 30)
SettingsTitle.Position = UDim2.new(0, 10, 0, 10)
SettingsTitle.BackgroundTransparency = 1
SettingsTitle.Text = "设置"
SettingsTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
SettingsTitle.TextSize = 18
SettingsTitle.TextXAlignment = Enum.TextXAlignment.Left
SettingsTitle.Font = Enum.Font.GothamBold
SettingsTitle.Parent = SettingsPage

-- 重置UI位置按钮
local ResetUIButton = Instance.new("TextButton")
ResetUIButton.Name = "ResetUIButton"
ResetUIButton.Size = UDim2.new(0.5, -15, 0, 35)
ResetUIButton.Position = UDim2.new(0, 10, 0, 50)
ResetUIButton.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
ResetUIButton.BorderSizePixel = 0
ResetUIButton.Text = "重置UI位置"
ResetUIButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResetUIButton.TextSize = 14
ResetUIButton.Font = Enum.Font.Gotham
ResetUIButton.Parent = SettingsPage

local ResetUICorner = Instance.new("UICorner")
ResetUICorner.CornerRadius = UDim.new(0, 6)
ResetUICorner.Parent = ResetUIButton

-- 隐藏UI按钮
local HideUIButton = Instance.new("TextButton")
HideUIButton.Name = "HideUIButton"
HideUIButton.Size = UDim2.new(0.5, -15, 0, 35)
HideUIButton.Position = UDim2.new(0.5, 5, 0, 50)
HideUIButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
HideUIButton.BorderSizePixel = 0
HideUIButton.Text = "隐藏UI"
HideUIButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HideUIButton.TextSize = 14
HideUIButton.Font = Enum.Font.Gotham
HideUIButton.Parent = SettingsPage

local HideUICorner = Instance.new("UICorner")
HideUICorner.CornerRadius = UDim.new(0, 6)
HideUICorner.Parent = HideUIButton

-- 最小化按钮
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -35, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "×"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 18
MinimizeButton.Visible = true
MinimizeButton.Parent = TitleBar

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

-- 最小化后的按钮（悬浮窗）
local MinimizedButton = Instance.new("TextButton")
MinimizedButton.Name = "MinimizedButton"
MinimizedButton.Size = UDim2.new(0, 50, 0, 50)
MinimizedButton.Position = UDim2.new(0, 10, 0, 10)
MinimizedButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
MinimizedButton.BorderSizePixel = 0
MinimizedButton.Text = "+"
MinimizedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizedButton.TextSize = 20
MinimizedButton.Visible = false
MinimizedButton.Parent = ScreenGui

local MinimizedCorner = Instance.new("UICorner")
MinimizedCorner.CornerRadius = UDim.new(0, 25)
MinimizedCorner.Parent = MinimizedButton

-- 变量
local ESPEnabled = false
local Flying = false
local FlySpeed = 500
local SpeedBoostEnabled = false
local WalkSpeed = 50
local BodyVelocity, BodyGyro
local ESPHighlights = {}
local CurrentPage = "HomePage"
local isAnimating = false
local SelectedPlayer = nil
local LockTeleportEnabled = false
local LockTeleportConnection = nil
local PlayerListExpanded = true
local OriginalWalkSpeed = 16
local SpeedBoostConnection = nil

-- 甩飞功能变量
local LockLaunchEnabled = false
local LockLaunchConnection = nil

-- 修复的UI动画函数
local function createOpenAnimation()
    if isAnimating then return end
    isAnimating = true
    
    MainContainer.Visible = true
    MinimizedButton.Visible = false
    
    local originalSize = UDim2.new(0, 600, 0, 550)
    local originalPosition = UDim2.new(0.5, -300, 0.5, -275)
    
    local buttonPos = MinimizedButton.AbsolutePosition
    local buttonSize = MinimizedButton.AbsoluteSize
    
    local startSize = UDim2.new(0, buttonSize.X, 0, buttonSize.Y)
    local startPos = UDim2.new(0, buttonPos.X, 0, buttonPos.Y)
    
    MainContainer.Size = startSize
    MainContainer.Position = startPos
    
    local sizeTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Size = originalSize}
    )
    
    local positionTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Position = originalPosition}
    )
    
    sizeTween:Play()
    positionTween:Play()
    
    delay(0.3, function()
        isAnimating = false
    end)
end

local function createCloseAnimation()
    if isAnimating then return end
    isAnimating = true
    
    local targetSize = MinimizedButton.Size
    local targetPos = MinimizedButton.Position
    
    local sizeTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Size = targetSize}
    )
    
    local positionTween = TweenService:Create(
        MainContainer,
        TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Position = targetPos}
    )
    
    sizeTween:Play()
    positionTween:Play()
    
    delay(0.25, function()
        MainContainer.Visible = false
        MinimizedButton.Visible = true
        isAnimating = false
    end)
end

-- 页面切换函数
local function switchPage(pageName)
    for _, child in ipairs(ContentFrame:GetChildren()) do
        if child:IsA("Frame") then
            child.Visible = false
        end
    end
    
    if ContentFrame:FindFirstChild(pageName) then
        ContentFrame[pageName].Visible = true
        CurrentPage = pageName
        
        if pageName == "TeleportPage" then
            updatePlayerList()
        end
    end
end

-- 更新玩家列表
local function updatePlayerList()
    for _, child in ipairs(PlayerScrollFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    local players = Players:GetPlayers()
    local yOffset = 0
    
    for i, plr in ipairs(players) do
        if plr ~= player then
            local playerButton = Instance.new("TextButton")
            playerButton.Name = plr.Name .. "Button"
            playerButton.Size = UDim2.new(1, -10, 0, 30)
            playerButton.Position = UDim2.new(0, 5, 0, yOffset)
            playerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
            playerButton.BorderSizePixel = 0
            playerButton.Text = plr.Name
            playerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            playerButton.TextSize = 12
            playerButton.Font = Enum.Font.Gotham
            playerButton.Parent = PlayerScrollFrame
            
            local playerButtonCorner = Instance.new("UICorner")
            playerButtonCorner.CornerRadius = UDim.new(0, 6)
            playerButtonCorner.Parent = playerButton
            
            playerButton.MouseButton1Click:Connect(function()
                SelectedPlayer = plr
                SelectedPlayerLabel.Text = "已选择: " .. plr.Name
                
                for _, btn in ipairs(PlayerScrollFrame:GetChildren()) do
                    if btn:IsA("TextButton") then
                        if btn == playerButton then
                            btn.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
                        else
                            btn.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
                        end
                    end
                end
            end)
            
            yOffset = yOffset + 35
        end
    end
    
    PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

-- 传送功能
local function teleportToPlayer()
    if not SelectedPlayer or not SelectedPlayer.Character then
        return
    end
    
    local targetChar = SelectedPlayer.Character
    local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
    local playerChar = player.Character
    local playerRoot = playerChar and playerChar:FindFirstChild("HumanoidRootPart")
    
    if targetRoot and playerRoot then
        playerRoot.CFrame = targetRoot.CFrame + targetRoot.CFrame.LookVector * 5
    end
end

-- 锁定传送功能
local function toggleLockTeleport()
    LockTeleportEnabled = not LockTeleportEnabled
    
    if LockTeleportEnabled then
        LockTeleportButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        LockTeleportButton.Text = "锁定传送: 开启"
        
        LockTeleportConnection = RunService.Heartbeat:Connect(function()
            if not SelectedPlayer or not SelectedPlayer.Character then
                return
            end
            
            local targetChar = SelectedPlayer.Character
            local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
            local playerChar = player.Character
            local playerRoot = playerChar and playerChar:FindFirstChild("HumanoidRootPart")
            
            if targetRoot and playerRoot then
                local offset = Vector3.new(0, 3, 0)
                playerRoot.CFrame = CFrame.new(targetRoot.Position + offset, targetRoot.Position)
            end
        end)
    else
        LockTeleportButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        LockTeleportButton.Text = "锁定传送: 关闭"
        
        if LockTeleportConnection then
            LockTeleportConnection:Disconnect()
            LockTeleportConnection = nil
        end
    end
end

-- 折叠/展开玩家列表
local function togglePlayerList()
    PlayerListExpanded = not PlayerListExpanded
    
    if PlayerListExpanded then
        PlayerListContainer.Size = UDim2.new(0.6, 0, 1, -10)
        ToggleListButton.Text = "◀"
        PlayerScrollFrame.Visible = true
    else
        PlayerListContainer.Size = UDim2.new(0, 150, 1, -10)
        ToggleListButton.Text = "▶"
        PlayerScrollFrame.Visible = false
    end
end

-- 甩飞功能
local function SkidFling(TargetPlayer)
    local Character = player.Character
    local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
    local RootPart = Humanoid and Humanoid.RootPart

    local TCharacter = TargetPlayer.Character
    local THumanoid
    local TRootPart
    local THead
    local Accessory
    local Handle

    if TCharacter:FindFirstChildOfClass("Humanoid") then
        THumanoid = TCharacter:FindFirstChildOfClass("Humanoid")
    end
    if THumanoid and THumanoid.RootPart then
        TRootPart = THumanoid.RootPart
    end
    if TCharacter:FindFirstChild("Head") then
        THead = TCharacter.Head
    end
    if TCharacter:FindFirstChildOfClass("Accessory") then
        Accessory = TCharacter:FindFirstChildOfClass("Accessory")
    end
    if Accessory and Accessory:FindFirstChild("Handle") then
        Handle = Accessory.Handle
    end

    if Character and Humanoid and RootPart then
        if RootPart.Velocity.Magnitude < 50 then
            getgenv().OldPos = RootPart.CFrame
        end
        if THumanoid and THumanoid.Sit then
            return
        end
        if THead then
            workspace.CurrentCamera.CameraSubject = THead
        elseif not THead and Handle then
            workspace.CurrentCamera.CameraSubject = Handle
        elseif THumanoid and TRootPart then
            workspace.CurrentCamera.CameraSubject = THumanoid
        end
        if not TCharacter:FindFirstChildWhichIsA("BasePart") then
            return
        end
        
        local FPos = function(BasePart, Pos, Ang)
            RootPart.CFrame = CFrame.new(BasePart.Position) * Pos * Ang
            Character:SetPrimaryPartCFrame(CFrame.new(BasePart.Position) * Pos * Ang)
            RootPart.Velocity = Vector3.new(9e7, 9e7 * 10, 9e7)
            RootPart.RotVelocity = Vector3.new(9e8, 9e8, 9e8)
        end
        
        local SFBasePart = function(BasePart)
            local TimeToWait = 2
            local Time = tick()
            local Angle = 0

            repeat
                if RootPart and THumanoid then
                    if BasePart.Velocity.Magnitude < 50 then
                        Angle = Angle + 100

                        FPos(BasePart, CFrame.new(0, 1.5, 0) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle),0 ,0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, 0) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(2.25, 1.5, -2.25) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(-2.25, -1.5, 2.25) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, 1.5, 0) + THumanoid.MoveDirection,CFrame.Angles(math.rad(Angle), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, 0) + THumanoid.MoveDirection,CFrame.Angles(math.rad(Angle), 0, 0))
                        task.wait()
                    else
                        FPos(BasePart, CFrame.new(0, 1.5, THumanoid.WalkSpeed), CFrame.Angles(math.rad(90), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, -THumanoid.WalkSpeed), CFrame.Angles(0, 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, 1.5, THumanoid.WalkSpeed), CFrame.Angles(math.rad(90), 0, 0))
                        task.wait()
                        
                        FPos(BasePart, CFrame.new(0, 1.5, TRootPart.Velocity.Magnitude / 1.25), CFrame.Angles(math.rad(90), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, -TRootPart.Velocity.Magnitude / 1.25), CFrame.Angles(0, 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, 1.5, TRootPart.Velocity.Magnitude / 1.25), CFrame.Angles(math.rad(90), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, 0), CFrame.Angles(math.rad(90), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, 0), CFrame.Angles(0, 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5 ,0), CFrame.Angles(math.rad(-90), 0, 0))
                        task.wait()

                        FPos(BasePart, CFrame.new(0, -1.5, 0), CFrame.Angles(0, 0, 0))
                        task.wait()
                    end
                else
                    break
                end
            until BasePart.Velocity.Magnitude > 500 or BasePart.Parent ~= TargetPlayer.Character or TargetPlayer.Parent ~= Players or not TargetPlayer.Character == TCharacter or THumanoid.Sit or Humanoid.Health <= 0 or tick() > Time + TimeToWait
        end
        
        workspace.FallenPartsDestroyHeight = 0/0
        
        local BV = Instance.new("BodyVelocity")
        BV.Name = "EpixVel"
        BV.Parent = RootPart
        BV.Velocity = Vector3.new(9e8, 9e8, 9e8)
        BV.MaxForce = Vector3.new(1/0, 1/0, 1/0)
        
        Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)
        
        if TRootPart and THead then
            if (TRootPart.CFrame.p - THead.CFrame.p).Magnitude > 5 then
                SFBasePart(THead)
            else
                SFBasePart(TRootPart)
            end
        elseif TRootPart and not THead then
            SFBasePart(TRootPart)
        elseif not TRootPart and THead then
            SFBasePart(THead)
        elseif not TRootPart and not THead and Accessory and Handle then
            SFBasePart(Handle)
        else
            return
        end
        
        BV:Destroy()
        Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
        workspace.CurrentCamera.CameraSubject = Humanoid
        
        repeat
            RootPart.CFrame = getgenv().OldPos * CFrame.new(0, .5, 0)
            Character:SetPrimaryPartCFrame(getgenv().OldPos * CFrame.new(0, .5, 0))
            Humanoid:ChangeState("GettingUp")
            table.foreach(Character:GetChildren(), function(_, x)
                if x:IsA("BasePart") then
                    x.Velocity, x.RotVelocity = Vector3.new(), Vector3.new()
                end
            end)
            task.wait()
        until (RootPart.Position - getgenv().OldPos.p).Magnitude < 25
        workspace.FallenPartsDestroyHeight = getgenv().FPDH
    else
        return
    end
end

-- 单次甩飞
local function launchPlayer()
    if not SelectedPlayer then
        return
    end
    
    SkidFling(SelectedPlayer)
end

-- 锁定甩飞
local function toggleLockLaunch()
    LockLaunchEnabled = not LockLaunchEnabled
    
    if LockLaunchEnabled then
        LockLaunchButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        LockLaunchButton.Text = "锁定甩飞: 开启"
        
        LockLaunchConnection = RunService.Heartbeat:Connect(function()
            if not SelectedPlayer then
                return
            end
            
            SkidFling(SelectedPlayer)
        end)
    else
        LockLaunchButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        LockLaunchButton.Text = "锁定甩飞: 关闭"
        
        if LockLaunchConnection then
            LockLaunchConnection:Disconnect()
            LockLaunchConnection = nil
        end
    end
end

-- 透视功能
local function toggleESP()
    ESPEnabled = not ESPEnabled
    
    if ESPEnabled then
        ESPButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        ESPButton.Text = "透视: 开启"
        
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = plr.Character
                highlight.FillColor = Color3.fromRGB(255, 50, 50)
                highlight.FillTransparency = 0.9
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineTransparency = 0.2
                highlight.Parent = plr.Character
                ESPHighlights[plr] = highlight
            end
        end
    else
        ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        ESPButton.Text = "透视: 关闭"
        
        for plr, highlight in pairs(ESPHighlights) do
            if highlight then
                highlight:Destroy()
            end
        end
        ESPHighlights = {}
    end
end

-- 飞行功能
local function toggleFly()
    Flying = not Flying
    
    if Flying then
        FlyButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        FlyButton.Text = "飞行: 开启"
        
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            BodyVelocity = Instance.new("BodyVelocity")
            BodyVelocity.Velocity = Vector3.new(0, 0, 0)
            BodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
            BodyVelocity.Parent = character.HumanoidRootPart
            
            BodyGyro = Instance.new("BodyGyro")
            BodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
            BodyGyro.P = 1000
            BodyGyro.Parent = character.HumanoidRootPart
            
            if character:FindFirstChild("Humanoid") then
                character.Humanoid.PlatformStand = true
            end
        end
    else
        FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        FlyButton.Text = "飞行: 关闭"
        
        if BodyVelocity then 
            BodyVelocity:Destroy()
            BodyVelocity = nil
        end
        if BodyGyro then 
            BodyGyro:Destroy() 
            BodyGyro = nil
        end
        
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.PlatformStand = false
        end
    end
end

-- 移动加速功能
local function toggleSpeedBoost()
    SpeedBoostEnabled = not SpeedBoostEnabled
    
    if SpeedBoostEnabled then
        SpeedBoostButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        SpeedBoostButton.Text = "移动加速: 开启"
        
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            OriginalWalkSpeed = character.Humanoid.WalkSpeed
            character.Humanoid.WalkSpeed = WalkSpeed
        end
        
        SpeedBoostConnection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = WalkSpeed
            end
        end)
    else
        SpeedBoostButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        SpeedBoostButton.Text = "移动加速: 关闭"
        
        if SpeedBoostConnection then
            SpeedBoostConnection:Disconnect()
            SpeedBoostConnection = nil
        end
        
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.WalkSpeed = OriginalWalkSpeed
        end
    end
end

-- 皮脚本功能
local function executePiScript()
    getgenv().XiaoPi="皮脚本QQ群894995244" 
    loadstring(game:HttpGet("https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"))()
end

-- 飞行控制
local lastUpdate = 0
local function updateFly()
    if not Flying or not BodyVelocity or not BodyGyro then return end
    
    local now = tick()
    if now - lastUpdate < 0.016 then return end
    lastUpdate = now
    
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = character.HumanoidRootPart
    
    local camCFrame = camera.CFrame
    local lookVector = camCFrame.LookVector
    local rightVector = camCFrame.RightVector
    local upVector = Vector3.new(0, 1, 0)
    
    local moveDirection = Vector3.new()
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then 
        moveDirection = moveDirection + lookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then 
        moveDirection = moveDirection - lookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then 
        moveDirection = moveDirection - rightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then 
        moveDirection = moveDirection + rightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then 
        moveDirection = moveDirection + upVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then 
        moveDirection = moveDirection - upVector
    end
    
    local targetCFrame = CFrame.new(root.Position, root.Position + lookVector)
    BodyGyro.CFrame = targetCFrame
    
    if moveDirection.Magnitude > 0 then
        BodyVelocity.Velocity = moveDirection.Unit * FlySpeed
    else
        BodyVelocity.Velocity = Vector3.new(0, 0, 0)
    end
end

-- 更新飞行速度滑块
local function updateSpeedSlider()
    local ratio = FlySpeed / 1000
    SliderFill.Size = UDim2.new(ratio, 0, 1, 0)
    SpeedLabel.Text = "飞行速度: " .. FlySpeed
end

-- 更新移动速度滑块
local function updateWalkSpeedSlider()
    local ratio = WalkSpeed / 500
    WalkSliderFill.Size = UDim2.new(ratio, 0, 1, 0)
    WalkSpeedLabel.Text = "移动速度: " .. WalkSpeed
    
    if SpeedBoostEnabled then
        local character = player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.WalkSpeed = WalkSpeed
        end
    end
end

-- 重置UI位置
local function resetUIPosition()
    MainContainer.Position = UDim2.new(0.5, -300, 0.5, -275)
    MinimizedButton.Position = UDim2.new(0, 10, 0, 10)
end

-- 隐藏UI
local function hideUI()
    ScreenGui.Enabled = false
end

-- 事件处理
MinimizeButton.MouseButton1Click:Connect(createCloseAnimation)
MinimizedButton.MouseButton1Click:Connect(createOpenAnimation)

-- 导航按钮点击
for _, button in ipairs(NavContainer:GetChildren()) do
    if button:IsA("TextButton") then
        button.MouseButton1Click:Connect(function()
            if button.Text == "主页" then
                switchPage("HomePage")
            elseif button.Text == "功能" then
                switchPage("FunctionsPage")
            elseif button.Text == "传送" then
                switchPage("TeleportPage")
            elseif button.Text == "其他脚本" then
                switchPage("OtherScriptsPage")
            elseif button.Text == "设置" then
                switchPage("SettingsPage")
            end
        end)
    end
end

-- 功能按钮
ESPButton.MouseButton1Click:Connect(toggleESP)
FlyButton.MouseButton1Click:Connect(toggleFly)
SpeedBoostButton.MouseButton1Click:Connect(toggleSpeedBoost)

-- 传送功能按钮
TeleportButton.MouseButton1Click:Connect(teleportToPlayer)
LockTeleportButton.MouseButton1Click:Connect(toggleLockTeleport)
ToggleListButton.MouseButton1Click:Connect(togglePlayerList)

-- 甩飞功能按钮
LaunchButton.MouseButton1Click:Connect(launchPlayer)
LockLaunchButton.MouseButton1Click:Connect(toggleLockLaunch)

-- 其他脚本功能按钮
PiScriptButton.MouseButton1Click:Connect(executePiScript)

-- 设置按钮
ResetUIButton.MouseButton1Click:Connect(resetUIPosition)
HideUIButton.MouseButton1Click:Connect(hideUI)

-- 飞行速度滑块控制
SliderButton.MouseButton1Down:Connect(function()
    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = UserInputService:GetMouseLocation()
            local sliderPos = SpeedSlider.AbsolutePosition.X
            local sliderSize = SpeedSlider.AbsoluteSize.X
            
            local x = math.clamp(mousePos.X - sliderPos, 0, sliderSize)
            local ratio = x / sliderSize
            FlySpeed = math.floor(ratio * 1000)
            updateSpeedSlider()
        end
    end)
    
    local endConnection
    endConnection = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
            endConnection:Disconnect()
        end
    end)
end)

-- 移动速度滑块控制
WalkSliderButton.MouseButton1Down:Connect(function()
    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = UserInputService:GetMouseLocation()
            local sliderPos = WalkSpeedSlider.AbsolutePosition.X
            local sliderSize = WalkSpeedSlider.AbsoluteSize.X
            
            local x = math.clamp(mousePos.X - sliderPos, 0, sliderSize)
            local ratio = x / sliderSize
            WalkSpeed = math.floor(ratio * 500)
            updateWalkSpeedSlider()
        end
    end)
    
    local endConnection
    endConnection = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
            endConnection:Disconnect()
        end
    end)
end)

-- 悬浮窗按钮拖动
local dragging = false
local dragStart, startPos

MinimizedButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MinimizedButton.Position
    end
end)

MinimizedButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        local newX = math.clamp(startPos.X.Offset + delta.X, 0, ScreenGui.AbsoluteSize.X - MinimizedButton.AbsoluteSize.X)
        local newY = math.clamp(startPos.Y.Offset + delta.Y, 0, ScreenGui.AbsoluteSize.Y - MinimizedButton.AbsoluteSize.Y)
        MinimizedButton.Position = UDim2.new(0, newX, 0, newY)
    end
end)

-- 玩家处理
Players.PlayerAdded:Connect(function(plr)
    if ESPEnabled and plr.Character then
        spawn(function()
            wait(0.1)
            if ESPEnabled and plr.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = plr.Character
                highlight.FillColor = Color3.fromRGB(255, 50, 50)
                highlight.FillTransparency = 0.9
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineTransparency = 0.2
                highlight.Parent = plr.Character
                ESPHighlights[plr] = highlight
            end
        end)
    end
    
    if CurrentPage == "TeleportPage" then
        updatePlayerList()
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if ESPHighlights[plr] then
        ESPHighlights[plr]:Destroy()
        ESPHighlights[plr] = nil
    end
    
    if SelectedPlayer == plr then
        SelectedPlayer = nil
        SelectedPlayerLabel.Text = "未选择玩家"
    end
    
    if CurrentPage == "TeleportPage" then
        updatePlayerList()
    end
end)

-- 角色重生处理
player.CharacterAdded:Connect(function(character)
    wait(1)
    
    if Flying then
        local wasFlying = Flying
        Flying = false
        FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        FlyButton.Text = "飞行: 关闭"
        
        wait(0.1)
        
        Flying = true
        FlyButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        FlyButton.Text = "飞行: 开启"
        
        if character and character:FindFirstChild("HumanoidRootPart") then
            BodyVelocity = Instance.new("BodyVelocity")
            BodyVelocity.Velocity = Vector3.new(0, 0, 0)
            BodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
            BodyVelocity.Parent = character.HumanoidRootPart
            
            BodyGyro = Instance.new("BodyGyro")
            BodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
            BodyGyro.P = 1000
            BodyGyro.Parent = character.HumanoidRootPart
            
            if character:FindFirstChild("Humanoid") then
                character.Humanoid.PlatformStand = true
            end
        end
    end
    
    if ESPEnabled then
        local wasESP = ESPEnabled
        ESPEnabled = false
        ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        ESPButton.Text = "透视: 关闭"
        
        wait(0.1)
        
        ESPEnabled = true
        ESPButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        ESPButton.Text = "透视: 开启"
        
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character then
                local highlight = Instance.new("Highlight")
                highlight.Adornee = plr.Character
                highlight.FillColor = Color3.fromRGB(255, 50, 50)
                highlight.FillTransparency = 0.9
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineTransparency = 0.2
                highlight.Parent = plr.Character
                ESPHighlights[plr] = highlight
            end
        end
    end
    
    if SpeedBoostEnabled then
        if character and character:FindFirstChild("Humanoid") then
            OriginalWalkSpeed = character.Humanoid.WalkSpeed
            character.Humanoid.WalkSpeed = WalkSpeed
        end
    end
end)

-- 初始化
updateSpeedSlider()
updateWalkSpeedSlider()

-- 飞行更新循环
RunService.Heartbeat:Connect(updateFly)

print("控制面板加载完成！已添加甩飞功能和皮脚本按钮。")
]]))

if not success then
    warn("脚本加载错误: " .. tostring(err))
else
    print("脚本成功加载！")
end
